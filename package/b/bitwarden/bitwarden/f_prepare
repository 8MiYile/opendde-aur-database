prepare() {
  # Link jslib
  rmdir "${srcdir}/desktop-${pkgver}/jslib"
  ln -s "${srcdir}/jslib-${_jslibcommit}" "${srcdir}/desktop-${pkgver}/jslib"
  cd "${srcdir}/desktop-${pkgver}"

  # Remove pre and postinstall routines from package.json.
  # This is required to build without a git repo and to make the builds more reproducible
  patch --strip=1 "${srcdir}/desktop-${pkgver}/package.json" \
    "${srcdir}/package.json.patch"
  # This patch is required to make "Start automatically on login" work
  patch --strip=1 "${srcdir}/desktop-${pkgver}/src/main/messaging.main.ts" \
    "${srcdir}/messaging.main.ts.patch"

  # Patch build to make it work with system electron
  local system_electron_version=$(pacman -Q electron11 | cut -d' ' -f2 | cut -d'-' -f1)
  jq < package.json --arg ver $system_electron_version\
  '.build["electronVersion"]=$ver | .build["electronDist"]="/usr/lib/electron11"'\
  > package.json.patched
  mv package.json.patched package.json
}
