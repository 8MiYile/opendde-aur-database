package() {
  cd "${pkgname%%-*}"

  install -Dm 644 COPYING -t "$pkgdir/usr/share/licenses/${pkgname%%-*}"

  install -dm 755 "$pkgdir/usr/share/doc/bitcoin"
  for _doc in $(find doc -maxdepth 1 -type f -name "*.md" -printf '%f\n') release-notes; do
      cp -dpr --no-preserve=ownership "doc/$_doc" "$pkgdir/usr/share/doc/bitcoin/$_doc"
  done

  install -dm 700 "$pkgdir/etc/bitcoin"

  make DESTDIR="$pkgdir" install

  install -Dm 600 "$srcdir/bitcoin.conf" -t "$pkgdir/etc/bitcoin"
  cat "$srcdir/bitcoin/share/examples/bitcoin.conf" >>"$pkgdir/etc/bitcoin/bitcoin.conf"

  install -Dm 644 "$srcdir/bitcoin/contrib/init/bitcoind.service" -t "$pkgdir/usr/lib/systemd/system"
  sed -i 's/StateDirectory/#StateDirectory/g' "$pkgdir/usr/lib/systemd/system/bitcoind.service"
  sed 's|\-daemon|\-daemon \-reindex|;s|Description=.*|Description=Bitcoin daemon (reindex)|' "$pkgdir/usr/lib/systemd/system/bitcoind.service" >"$pkgdir/usr/lib/systemd/system/bitcoind-reindex.service"

  install -Dm 644 "$srcdir/bitcoin-sysusers.conf" "$pkgdir/usr/lib/sysusers.d/bitcoin.conf"

  install -Dm 644 "$srcdir/bitcoind.logrotate" "$pkgdir/etc/logrotate.d/bitcoin"

  for _compl in bitcoin-cli bitcoin-tx bitcoind; do
    install -Dm 644 "contrib/${_compl}.bash-completion" \
      "$pkgdir/usr/share/bash-completion/completions/$_compl"
  done

  # NB: pacman hook on Remove event not firing
  install -Dm 644 "$srcdir"/*.hook -t "$pkgdir/usr/share/libalpm/hooks"
}
