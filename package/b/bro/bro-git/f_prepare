prepare() {
  cd ${pkgname}

  # Update submodules
  git submodule update --init --recursive

  # Change the cmake/OpenSSLTests.cmake file to bypass targeting the wrong library version...
  patch -N -p1 -i "${srcdir}/cmake_OpenSSLTests.patch" || true

  # Create Makefiles
  ./configure --prefix=/usr --spooldir=/var/spool/bro --logdir=/var/log/bro --conf-files-dir=/etc/bro --with-openssl=/usr/include/openssl-1.0

  # Temporary fix until openssl-1.1 is supported
  sed -i 's/^OPENSSL_CRYPTO_LIBRARY.*/OPENSSL_CRYPTO_LIBRARY:FILEPATH=\/usr\/lib\/openssl-1.0\/libcrypto.so/' build/CMakeCache.txt
  sed -i 's/^OPENSSL_INCLUDE_DIR.*/OPENSSL_INCLUDE_DIR:PATH=\/usr\/include\/openssl-1.0/' build/CMakeCache.txt
  sed -i 's/^OPENSSL_SSL_LIBRARY.*/OPENSSL_SSL_LIBRARY:FILEPATH=\/usr\/lib\/openssl-1.0\/libssl.so/' build/CMakeCache.txt
}
