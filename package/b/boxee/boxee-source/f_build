build() {
	pushd ${_src} || return 1
		#this section contains changes required for x86_64 and thus is only loaded if your arch is x86_64
		if [ $(uname -m) = "x86_64" ]; then
			#boxee64.patch allows boxee to compile on 64bit systems
			patch -p0 < ../boxee64.patch || return 1
			#ffmpeg needs to be patched for 64bit systems
		#	patch -p0 < ../ffmpeg64.patch || return 1

			#two symlinks added by paulingham that work with boxee64.patch to allow boxee to compile on x86_64
			pushd xbmc/lib/libsmb || return 1
				ln -s /usr/lib/libtalloc.so.1 libtalloc-x86_64-linux.a
				ln -s /usr/lib/libwbclient.so.0 libwbclient-x86_64-linux.a
			popd || return 1
			_xulrunner=xulrunner-x86_64-linux
		else
			_xulrunner=xulrunner-i486-linux
		fi || return 1
		

		#anish.patch adds some minor tweaks anish figured out to get the latest sources running
		#patch -p0 < ../anish.patch || return 1

		#fribidi.patch fixes the compile issue related to fribidi (big thanks to vrtladept and anish for getting this one rolling)
		#patch -p0 < ../fribidi.patch || return 1

		#patch to compile against libpng14, thanks to wonder for providing the original patch
		patch -p0 < ../libpng.patch || return 1
		patch -p0 < ../libpng15.patch

		#patch to compilet release 0.9.21.12563, remove extraneous function calls that cause linkage failure
#		patch -p0 < ../12563_fix.patch || return 1
		
		#patch to fix missing libs in Makefile
		patch -p0 < ../libfix.patch || return 1

		#thank the fedora guys for this
		patch -p0 < ../mysql_fix.patch || return 1

		#remocpile libjpeg with fPIC
                pushd xbmc/lib/cximage-6.0/jpeg-turbo
                        autoreconf -vif
                popd

		# compile libavcodec under gcc 4.7
		patch -p1 < ../libavcodec.patch
		patch -p0 < ../gcc4.7.patch

		patch -p0 < ../libjpeg_cflags.patch || return 1

		patch -p0 < ../fixtypediff.patch

		patch -p0 < ../ssaver_fix.patch

		patch -p0 < ../misc.patch

		#smbno.h was deprecated in the kernel, the boxee guys leave us hanging as usual
#		patch -p0 < ../samba.patch || return 1
#		cp ../smbno.h xbmc/cores/paplayer/MACDll/Source/MACLib/. || return 1
		
		#tinyxpath and goom need to be reconfigured so they link against the correct utilities (another thanks to anish for this one)
		pushd xbmc/lib/libBoxee/tinyxpath || return 1
			autoreconf -vif || return 1
			./configure || return 1
		popd || return 1

		pushd xbmc/cores/dvdplayer/Codecs/libfaad2 
			autoreconf -vif
		popd

		pushd xbmc/lib/libid3tag/libid3tag
			autoreconf -vif
		popd

		pushd xbmc/lib/libbluray
			autoreconf -vif
		popd

		pushd xbmc/lib/libdvbpsi
			autoreconf -vif
		popd

		pushd xbmc/lib/harfbuzz/harfbuzz
			autoreconf -vif
		popd

		pushd xbmc/visualizations/Goom/goom2k4-0 || return 1
			aclocal || return 1
			libtoolize --copy --force || return 1
			./autogen.sh --enable-static --with-pic || return 1
		popd || return 1
	
		#thanks to bralkein	
		pushd xbmc/lib/libass/ || return 1
			autoreconf --install || return 1
		popd || return 1
		
		aclocal || return 1
		autoheader || return 1
		autoconf || return 1
		#if anyone wants pulseaudio, simply remove "--disable-pulse"
		./configure --prefix=/opt/boxee --enable-mid --disable-debug --disable-pulse --enable-xrandr --disable-ccache --enable-vdpau LIBS="-lm" || return 1
	
		#this is another hack to fix an issue with gcc44-- once again I'm using sed because the Makefile is generated in this package
		if [ $(uname -m) = "x86_64" ]; then
			sed -r 's/\(MAKE\)\ -C\ xbmc\/screensavers$/\(MAKE\)\ CFLAGS=\"-march=k8\ -02\ -pipe\"\ -C\ xbmc\/screensavers/g' Makefile > Makefile.sed || return 1
		else
			sed -r 's/\(MAKE\)\ -C\ xbmc\/screensavers$/\(MAKE\)\ CFLAGS=\"-march=i486\ -02\ -pipe\"\ -C\ xbmc\/screensavers/g' Makefile > Makefile.sed || return 1
		fi
		cat Makefile.sed > Makefile || return 1

		make || return 1

		if [ $(uname -m) = "x86_64" ]; then
			make -C tools/TexturePacker -f Makefile.host64
		else
			make -C tools/TexturePacker -f Makefile.host
		fi
#		rm skin/boxee/media/Textures.xbt
		make -C skin/boxee/media

	popd || return 1
}
