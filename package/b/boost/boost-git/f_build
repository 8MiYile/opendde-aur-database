build() {
  local JOBS="$(sed -e 's/.*\(-j *[0-9]\+\).*/\1/' <<< ${MAKEFLAGS})"

  cd boost

  ( cd tools/build
    ./bootstrap.sh --cxxflags="$CXXFLAGS $LDFLAGS"
    ./b2 install --prefix="$srcdir/fakeinstall"
    ln -s b2 "$srcdir/fakeinstall/bin/bjam" )

  ./bootstrap.sh --with-toolset=gcc --with-icu --with-python=python3

  # Support for OpenMPI
  echo "using mpi ;" >> project-config.jam

  # boostbook is needed by quickbook
  install -dm755 "$srcdir/fakeinstall/share/boostbook"
  cp -a tools/boostbook/{xsl,dtd} "$srcdir/fakeinstall/share/boostbook/"

  # default "minimal" install: "release link=shared,static
  # runtime-link=shared threading=single,multi"
  # --layout=tagged will add the "-mt" suffix for multithreaded libraries
  # and installs includes in /usr/include/boost.
  # --layout=system no longer adds the -mt suffix for multi-threaded libs.
  # install to $srcdir/fakeinstall in preparation for split packaging
  ./b2 install \
     variant=release \
     debug-symbols=off \
     threading=multi \
     runtime-link=shared \
     link=shared,static \
     toolset=gcc \
     python="$_py" \
     cflags="$CPPFLAGS $CFLAGS -fPIC -O3 -ffat-lto-objects" \
     cxxflags="$CPPFLAGS $CXXFLAGS -fPIC -O3 -ffat-lto-objects" \
     linkflags="$LDFLAGS" \
     --layout=system \
     ${JOBS} \
     \
     --prefix="$srcdir/fakeinstall"
}
