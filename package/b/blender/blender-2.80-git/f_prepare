prepare() {
  # update the submodules
  git -C "$srcdir/blender" submodule update --init --recursive --remote
  if [ ! -v _cuda_capability ] && grep -q nvidia <(lsmod); then
    git -C "$srcdir/blender" apply -v "${srcdir}"/SelectCudaComputeArch.patch
  fi
  if [[ -v _suffix ]]; then
    git -C "$srcdir/blender" apply -v <(sed "s/@@_suffix@@/${_suffix}/g" "${srcdir}/addon_path.patch")
  fi
  git -C "$srcdir/blender" apply -v "$srcdir"/{cpp14,python{3.8,39},openvdb8,osl111}.patch
}
