prepare() {
  cd "${pkgname}-source"
  git submodule update --init --recursive
  # Remove default build type
  sed '/CMAKE_BUILD_TYPE/d' -i 'CMakeLists.txt'
  # Build without x86_64 assembly parts
  cmake -DUSE_ASM=OFF -DCMAKE_BUILD_TYPE=Release
  # Create launcher
  tee 'launch.sh' << END
#!/bin/sh
cd /usr/share/${_pkgname}
exec ./asm2048
END
  # Create desktop entry
  tee 'launch.desktop' << END
[Desktop Entry]
Name=2048
Version=1.0
GenericName=Sliding number puzzle game
Exec=/usr/bin/${_pkgname}
Icon=${_pkgname}
Type=Application
Categories=Game;
Keywords=Puzzle;2D;Block;Number;Animated;
Terminal=false
StartupNotify=false
Comment=Animated graphical 2048 sliding block puzzle game written in C and SDL2
END
  # Patch upstream with release-specific changes
  git apply ../release.diff
}
