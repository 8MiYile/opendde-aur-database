build() {
	# Run installer silently in temporary Wine environment
	install -m755 -d "$srcdir"/tmp "$srcdir"/tmp/env "$srcdir"/tmp/local
	export XDG_DATA_HOME="$srcdir"/tmp/local
	export WINEPREFIX="$srcdir"/tmp/env
	export WINEARCH=win32
	export WINEDEBUG=-all
	export WINEDLLOVERRIDES=mscoree=d
	wine "$srcdir"/setup.exe /s /v/qn

	# Extract icon generated by winemenubuilder during installation
	icon_name=$(grep "Icon" tmp/local/applications/wine/Programs/AG\ DSP\ Controller.desktop | cut -d '=' -f 2)
	install -m644 "$srcdir"/tmp/local/icons/hicolor/256x256/apps/"$icon_name".png "$srcdir"/"$pkgname".png

	# Apply binary patch so that program looks for "AG06/AG03 - AG06/AG03 MIDI 1" as the MIDI device name instead of "AG06/AG03"
	bspatch "$srcdir"/tmp/env/drive_c/Program\ Files/YAMAHA/AG\ DSP\ Controller/ag_dsp_controller.exe "$srcdir"/ag_dsp_controller_patched.exe "$srcdir"/fix-midi-device-name.patch
}
