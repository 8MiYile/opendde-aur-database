prepare() {
  cd "${srcdir}/abiword-${pkgver}"

  # fix build with librevenge based import filters
  patch -Np0 -i "${srcdir}"/abiword-3.0.0-librevenge.patch

  # Fix libwpd 0.4 detection
  patch -Np1 -i "${srcdir}"/abiword-3.0.1-libwps-0.4.patch
  
  # Fix python override code to work with Python 3.x
  patch -Np1 -i "${srcdir}"/python-override.patch

  # Fix black on black (FS#51667)
  # http://bugzilla.abisource.com/show_bug.cgi?id=13815
  patch -Np1 -i "${srcdir}"/bug13815.patch

  # Install missing m4 files
  install -m644 "${srcdir}"/aiksaurus-plugin.m4 plugins/aiksaurus/plugin.m4
  install -m644 "${srcdir}"/command-plugin.m4 plugins/command/plugin.m4

  # Generate m4 file for configure
  find plugins -name plugin.m4 | xargs cat > plugin-configure.m4

  libtoolize --force
  autoreconf -fi
}
