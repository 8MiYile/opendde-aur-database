prepare() {
    cd "$srcdir/${pkgname}-${pkgver}"

    git submodule init

    git config submodule."modules/uavcan".url "${srcdir}/${pkgname}"-libuavcan
    git config submodule."modules/waf".url "${srcdir}/${pkgname}"-waf
    git config submodule."modules/gbenchmark".url "${srcdir}/${pkgname}"-benchmark
    git config submodule."modules/mavlink".url "${srcdir}/${pkgname}"-mavlink
    git config submodule."gtest".url "${srcdir}/${pkgname}"-googletest
    git config submodule."modules/ChibiOS".url "${srcdir}/${pkgname}"-ChibiOS
    git config submodule."modules/gsoap".url "${srcdir}/${pkgname}"-gsoap
    git config submodule."modules/DroneCAN/DSDL".url "${srcdir}/${pkgname}"-DSDL
    # git config submodule."modules/CrashDebug".url "${srcdir}/${pkgname}"-CrashDebug
    git config submodule."modules/DroneCAN/pydronecan".url "${srcdir}/${pkgname}"-pydronecan
    git config submodule."modules/DroneCAN/dronecan_dsdlc".url "${srcdir}/${pkgname}"-dronecan_dsdlc
    git config submodule."modules/DroneCAN/libcanard".url "${srcdir}/${pkgname}"-libcanard

    git submodule update --init --recursive

    patch -Np1 -i "${srcdir}"/uninitialized.patch
}
