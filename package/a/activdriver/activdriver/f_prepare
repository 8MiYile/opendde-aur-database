prepare() {
  # Extract the source
  bsdtar -xf data.tar.xz
 
  # Patch the makefile of activlc so it doesn't try to get its includes from an absoulte path outside the build chroot
  sed -i "s%KERN_INC = /usr/src/promethean%KERN_INC = ..%" usr/src/promethean/activlc/Makefile
  
  # Patch promethean.sh to not use absolute paths to /usr/local, which isn't used in Arch
  sed -i s%/usr/local/bin/%%g usr/bin/promethean.sh
  
  # Patch usbpromethean.c to be compatible with this kernel change: https://lkml.org/lkml/2019/1/4/418
  # If are building on kernel versions <=4.19, remove these 2 lines
  sed -i  s%VERIFY_WRITE,%%g usr/src/promethean/kernel/usbpromethean.c
  sed -i  s%VERIFY_READ,%%g usr/src/promethean/kernel/usbpromethean.c
  
   # Remove files relating to HAL, which was deprecated by Arch almost a decade ago
  rm -r usr/share/hal
  
  # The driver includes two duplicate X configuration files and this path isn't used in Arch
  rm -r usr/lib/X11/xorg.conf.d
}
