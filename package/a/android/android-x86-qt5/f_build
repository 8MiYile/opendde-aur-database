build() {
    cd ${_pkgfqn}
    source android-env ${_android_arch}

    unset CC
    unset CXX
    unset CFLAGS
    unset CXXFLAGS
    unset LDFLAGS
    unset CHOST
    unset QMAKESPEC
    unset QTDIR
    unset CARCH
    export PKG_CONFIG=$ANDROID_PKGCONFIG
    export PYTHON=/usr/bin/python2
    export ANDROID_TARGET_ARCH="${ANDROID_ABI}"

    configue_opts="
        -confirm-license
        -opensource
        -silent
        -prefix ${ANDROID_PREFIX}
        -examplesdir ${ANDROID_PREFIX_SHARE}/qt5/examples
        -testsdir ${ANDROID_PREFIX_SHARE}/qt5/tests
        -xplatform android-clang
        --disable-rpath
        -nomake tests
        -nomake examples
        -skip qtserialport
        -skip qtwebengine
        -no-warnings-are-errors
        -pkg-config
        -system-libjpeg
        -system-libpng
        -system-tiff
        -system-webp
        -system-zlib
        -no-feature-geoservices_mapbox
        -no-feature-geoservices_mapboxgl
        -openssl-runtime
        -qt-freetype
        -android-sdk ${ANDROID_HOME}
        -android-ndk ${ANDROID_NDK_HOME}
        -android-ndk-host linux-x86_64
        -android-abis ${ANDROID_ABI}
        -android-ndk-platform ${ANDROID_NDK_PLATFORM}
        -recheck-all
        -optimized-qmake
        -I${ANDROID_PREFIX}/include"

    [[ $QT_ANDROID_DEBUG_BUILD ]] \
        && configue_opts+=' -debug-and-release' \
        || configue_opts+=' -release'

    # Platform specific patches
    case "$_android_arch" in
        x86)
             configue_opts+="
                 -no-sql-mysql
                 -no-sql-psql"
            ;;
        x86-64)
             configue_opts+="
                 -no-avx2
                 -no-sql-mysql
                 -no-sql-psql"
            ;;
        *)
            ;;
    esac

    ./configure ${configue_opts}
    make $MAKEFLAGS
}
