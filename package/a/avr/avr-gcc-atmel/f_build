build() {
  cd ${srcdir}/gcc

  # default CFLAGS lead to issues later on when configure
  # calls avr-gcc with -march set.
  export CFLAGS="-O2 -pipe"
  export CXXFLAGS="-O2 -pipe"

  config_guess=$(./config.guess)

  cd ${_builddir}

  # major differences from avr build script:
  #   --disable-shared
  CFLAGS="-Os -g0 -s" ${srcdir}/gcc/configure \
        --target=avr \
        --host=${config_guess} \
        --build=${config_guess} \
        --prefix=/usr \
        --enable-languages="c,c++" \
        --with-dwarf2 \
        --enable-doc \
        --enable-shared \
        --disable-libada \
        --disable-libssp \
        --disable-nls \
        --with-ld=/usr/bin/avr-ld \
        --with-as=/usr/bin/avr-as \
        --disable-install-libiberty \
        --with-avrlibc=yes

  make all
}
