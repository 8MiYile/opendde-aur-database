build() {
  cd "$srcdir/$_pkgname-$pkgver"

  tar -xpzf "$_pkgname-$pkgver.src.tar.gz"
  cd "$_pkgname-$pkgver"

  patch -Np1 -i ../../grub-0.97-ldflags-objcopy-remove-build-id.patch
  patch -Np1 -i ../../automake-pkglib.patch

  sed -e'/^AC_PROG_CC/ a\AM_PROG_CC_C_O\ ' -i configure.ac
  sed -e'/^AC_PROG_CC/ a\AM_PROG_AS\ ' -i configure.ac

  aclocal
  autoconf
  autoreconf
  automake

  CFLAGS="-static -fno-strict-aliasing" ./configure --prefix=/usr \
    --bindir=/bin --sbindir=/sbin --mandir=/usr/share/man \
    --infodir=/usr/share/info

  gcc util/create_sha1.c -o util/create_sha1
  gcc util/verify_pcr.c -o util/verify_pcr
  CFLAGS= make
  chmod g+w * -R
  chmod a+x util/grub-install
}
