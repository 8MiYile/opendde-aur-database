prepare() {
  cd "${pkgname%*-git}"

  # Don't build tests
  truncate -s 0 cmake/FindGMock.cmake
  truncate -s 0 tests/CMakeLists.txt

  # Thanks to @bartus <arch-user-repo@bartus.33mail.com> for suggesting the patch
  # checking before applying it.
  # Original patch: http://ix.io/3Clr
  printf '%s\n' "${source[@]%%::*}" \
    | awk -F . '/\.patch/{print $1}' \
    | while read -r patch;do
        if patch --dry-run -Np1 -Rsf < "$srcdir/$patch.patch" &> /dev/null; then
          warning "Patch already applied, please remove $patch.patch from source[]!"
          read -t5 -p 'press enter to continue...' || true
        else
          msg "Applying patch: $patch"
          patch -Np1 < "$srcdir/$patch.patch"
        fi
      done
}
