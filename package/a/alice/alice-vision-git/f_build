build() {
  ((DISABLE_CUDA|DISABLE_UTE)) || {
    msg2 "Build uncertaintyTE library"
    cmake -DCMAKE_INSTALL_PREFIX=/ -DMAGMA_ROOT=/usr -G Ninja -S ute_lib -B ute_build
# shellcheck disable=SC2086 # ninja call won't work with shell substitution in quotes.
    ninja ${MAKEFLAGS:--j1} -C ute_build
    DESTDIR="${srcdir}/ute_bin" ninja -C ute_build install
  }

  msg2 "Build geogram library"
  CFLAGS+=" -fcommon" cmake -DCMAKE_INSTALL_PREFIX=/ -DGEOGRAM_LIB_ONLY=ON -DGEOGRAM_USE_SYSTEM_GLFW3=ON -DCMAKE_BUILD_TYPE:STRING=Release -DVORPALINE_PLATFORM:STRING=Linux64-gcc-dynamic -G Ninja -S geogram -B geogram_build
# shellcheck disable=SC2086 # expand MAKEFLAGS.
  ninja ${MAKEFLAGS:--j1} -C geogram_build
  DESTDIR="${srcdir}/geogram_bin" ninja -C geogram_build install

  msg2 "Build AliceVision library"
  cmake "${_CMAKE_FLAGS[@]}" -DGEOGRAM_INSTALL_PREFIX="${srcdir}/geogram_bin" -DUNCERTAINTYTE_DIR="${srcdir}/ute_bin" -G Ninja -S ${pkgname} -B build
# shellcheck disable=SC2086 # expand MAKEFLAGS.
  ninja ${MAKEFLAGS:--j1} -C build
}
